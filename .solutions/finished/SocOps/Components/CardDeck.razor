@using SocOps.Data

<div class="flex flex-col min-h-full">
    <!-- Header -->
    <header class="flex items-center justify-between p-3 bg-card border-b border-cyan">
        <button
            @onclick="OnBack"
            class="text-cyan text-sm px-3 py-1.5 rounded border border-cyan transition-all hover:shadow-neon">
            ‚Üê EXIT
        </button>
        <h1 class="font-bold text-cyan font-display tracking-wider neon-text">CARD DECK</h1>
        <button
            @onclick="ResetDeck"
            class="text-magenta text-sm px-3 py-1.5 rounded border border-magenta transition-all hover:shadow-neon">
            SHUFFLE
        </button>
    </header>

    <!-- Card Area -->
    <div class="flex-1 flex items-center justify-center p-6">
        <div class="relative w-full max-w-sm">
            <!-- Clickable Card -->
            <button @onclick="HandleCardTap" class="w-full aspect-[3/4] perspective-1000" disabled="@IsAllDone">
                @if (!IsFlipped)
                {
                    <!-- Card Back - Tap to Reveal -->
                    <div class="absolute inset-0 bg-card rounded-2xl neon-border flex flex-col items-center justify-center p-6">
                        <div class="text-6xl mb-4">üé¥</div>
                        <p class="text-cyan font-display uppercase tracking-wider">TAP TO REVEAL</p>
                    </div>
                }
                else
                {
                    <!-- Card Front - Question -->
                    <div class="absolute inset-0 bg-card rounded-2xl neon-border-pink flex flex-col items-center justify-center p-6 text-center">
                        <p class="text-2xl font-semibold text-white mb-8 leading-relaxed">
                            @CurrentQuestion
                        </p>
                        <p class="text-sm text-gray-500 font-display uppercase">
                            Find someone who...
                        </p>
                    </div>
                }
            </button>
        </div>
    </div>

    <!-- Action Buttons -->
    @if (IsFlipped && !IsAllDone)
    {
        <div class="p-4 flex gap-4">
            <button
                @onclick="() => HandleResult(false)"
                class="flex-1 py-4 bg-card border border-magenta rounded-lg text-magenta font-display uppercase tracking-wider transition-all hover:shadow-neon">
                ‚úó NO MATCH
            </button>
            <button
                @onclick="() => HandleResult(true)"
                class="flex-1 py-4 bg-card border border-cyan rounded-lg text-cyan font-display uppercase tracking-wider transition-all hover:shadow-neon">
                ‚úì FOUND ONE
            </button>
        </div>
    }

    <!-- Stats -->
    <div class="p-4 bg-card border-t border-cyan">
        <div class="flex justify-around text-center">
            <div>
                <div class="text-2xl font-bold text-cyan neon-text">@MatchCount</div>
                <div class="text-xs text-gray-500 font-display uppercase">Matches</div>
            </div>
            <div>
                <div class="text-2xl font-bold text-magenta neon-text-pink">@SkipCount</div>
                <div class="text-xs text-gray-500 font-display uppercase">Skipped</div>
            </div>
            <div>
                <div class="text-2xl font-bold text-white">@CardsRemaining</div>
                <div class="text-xs text-gray-500 font-display uppercase">Remaining</div>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public EventCallback OnBack { get; set; }

    private List<string> Deck = new();
    private int CurrentIndex = 0;
    private bool IsFlipped = false;
    private int MatchCount = 0;
    private int SkipCount = 0;

    private string CurrentQuestion => CurrentIndex < Deck.Count ? Deck[CurrentIndex] : "All done! üéâ";
    private int CardsRemaining => Math.Max(0, Deck.Count - CurrentIndex);
    private bool IsAllDone => CurrentIndex >= Deck.Count;

    protected override void OnInitialized()
    {
        ShuffleDeck();
    }

    private void ShuffleDeck()
    {
        var random = new Random();
        Deck = Questions.QuestionsList.OrderBy(_ => random.Next()).ToList();
        CurrentIndex = 0;
        IsFlipped = false; // Start with card face down
    }

    private void ResetDeck()
    {
        ShuffleDeck();
        MatchCount = 0;
        SkipCount = 0;
    }

    private void HandleCardTap()
    {
        if (!IsFlipped && !IsAllDone)
        {
            IsFlipped = true; // Reveal the card
        }
    }

    private void HandleResult(bool isMatch)
    {
        if (isMatch)
            MatchCount++;
        else
            SkipCount++;

        CurrentIndex++;
        IsFlipped = false; // Show next card face down
    }
}

<style>
    .perspective-1000 {
        perspective: 1000px;
    }
</style>
